<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>

    <div id="infousuario">

    </div>

    <a href="registrarHoras.html">Registrar Horas</a>
    <br>
    <a href="verHorastrabajadas.html">Ver Horas Trabajadas</a>
    <br>
    <a href="anadirComprobantePago.html">Ver deudas pendientes y añadir comprobantes</a>
    <br>
    <a href="pagosPorAprobar.html">Ver pagos por aprobar</a>
    <br>
    <a href="pagosAprobados.html">Ver historial de pagos aprobados</a>


    <script>

        function mostrarUsuario(){

            const url = `apiUsuarios.php?accion=getUsuario`;

            fetch(url)
            .then(response => {
            const contentType = response.headers.get("content-type");
            if (contentType && contentType.includes("application/json")) {
                return response.json();
            }else{
                throw new Error("La respuesta no es JSON válida");
            }
            })
            .then(data => {
                if (Array.isArray(data.message)) {
                    if(data.message.length > 0){
                        llenarDatos(data.message);
                    }
                }else{
                    throw new Error("El formato del JSON no es válido");
                }
            })
            .catch(error => {
            console.error('Error:', error);
            alert("Ocurrió un error al mostrar data.");
            });
        }

        function llenarDatos(data){
            const div = document.getElementById('infousuario');

            data.forEach(data => {

            const nombre = document.createElement('p');
            const ci = document.createElement('p');

            nombre.innerHTML = `
                <p>
                Bienvenido ${data.Nombre} 
                </p>
            `;

            ci.innerHTML = `
                <p>
                CI: ${data.CI}
                </p>
            `;
            
            div.appendChild(nombre);
            div.appendChild(ci);
            });

        }

        function verificarSesion(){
            const url = `apiUsuarios.php?accion=verificarUsuario`;
            fetch(url)
            .then(response => {
            const contentType = response.headers.get("content-type");
            if (contentType && contentType.includes("application/json")) {
                return response.json();
            } else {
                throw new Error("La respuesta no es JSON válida");
            }
            })
            .then(data => {
            if (data.redirect) {
                window.location.href = data.redirect;
            } else {
                console.log('Respuesta:', data);
                alert(data.message || "Error en el inicio de sesión.");
            }
            })
        }

        window.onload = function () {
            verificarSesion();
            mostrarUsuario();
        };
    </script>
</body>
</html>